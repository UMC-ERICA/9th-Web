<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History API SPA 구현</title>
    <link rel="icon" href="data:,"> 
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* CSS 애니메이션 추가: 페이지 전환 효과 */
        .page-content {
            transition: opacity 0.3s ease-in-out;
            opacity: 1;
        }
        .fade-out {
            opacity: 0;
        }
        /* 네비게이션 링크 스타일: 기본 링크 형태 유지 */
        .nav-link {
            font-weight: 600; /* 굵게 */
            cursor: pointer;
            text-decoration: underline; /* 밑줄 적용 */
        }
        body {
            /* 배경색을 흰색으로 설정하고 전체적으로 패딩을 줍니다. */
            padding: 16px;
            background-color: white;
            color: black;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- 내비게이션: 배경색, 그림자 제거하고 단순 텍스트 링크 형태로 변경 -->
    <nav class="mb-6 border-b border-gray-200 pb-2">
        <div class="flex gap-4 text-xl">
            <!-- 이미지 스타일: 일반 링크 형태, 텍스트는 대문자 -->
            <a href="/seunghee" data-path="/seunghee" class="nav-link text-purple-700 hover:text-purple-900 transition duration-150">SEUNGHEE</a>
            <a href="/aeong" data-path="/aeong" class="nav-link text-purple-700 hover:text-purple-900 transition duration-150">AEONG</a>
            <a href="/joy" data-path="/joy" class="nav-link text-purple-700 hover:text-purple-900 transition duration-150">JOY</a>
            <a href="/not-found" data-path="/not-found" class="nav-link text-red-700 hover:text-red-900 transition duration-150">NOT FOUND</a>
        </div>
    </nav>

    <main id="app-root" class="p-4">
        <!-- 초기 로딩 메시지 제거: JS가 즉시 첫 페이지를 렌더링합니다. -->
    </main>

    <script>
        // 1. 컴포넌트 데이터 정의 (경로에 따라 렌더링될 내용)
        const routes = {
            '/seunghee': { 
                title: '승희 페이지', 
                content: `
                    <h2 class="text-4xl font-bold text-gray-900 mb-4">승희 페이지</h2>
                    <p class="text-lg text-gray-700">Seunghee의 프로필 정보가 표시되는 페이지입니다.</p>
                `
            },
            '/aeong': { 
                title: '애옹 페이지', 
                content: `
                    <h2 class="text-4xl font-bold text-gray-900 mb-4">애옹 페이지</h2>
                    <p class="text-lg text-gray-700">Aeong의 프로필 정보가 표시되는 페이지입니다.</p>
                `
            },
            '/joy': { 
                title: '조이 페이지', 
                content: `
                    <h2 class="text-4xl font-bold text-gray-900 mb-4">조이 페이지</h2>
                    <p class="text-lg text-gray-700">Joy의 프로필 정보가 표시되는 페이지입니다.</p>
                `
            },
            '/': { 
                title: '홈페이지', 
                content: `
                    <h2 class="text-4xl font-bold text-gray-900 mb-4">홈페이지</h2>
                    <p class="text-lg text-gray-700">SPA 라우팅 테스트 시작점입니다. 상단 링크를 클릭하세요.</p>
                `
            },
            '/not-found': { // NOT FOUND 링크를 위한 명시적 경로
                title: '페이지 없음',
                content: `
                    <h2 class="text-4xl font-bold text-red-600 mb-4">NOT FOUND</h2>
                    <p class="text-lg text-gray-700">이 경로는 페이지를 찾을 수 없음을 보여주는 예시입니다.</p>
                `
            },
            '404': { // 정의되지 않은 모든 경로
                title: '404 - 페이지를 찾을 수 없음', 
                content: `
                    <h2 class="text-4xl font-bold text-red-600 mb-4">404 - 페이지를 찾을 수 없음</h2>
                    <p class="text-lg text-gray-700">요청하신 경로를 찾을 수 없습니다.</p>
                    <a href="/" data-path="/" class="nav-link inline-block mt-6 text-purple-700 hover:text-purple-900">홈 페이지로 돌아가기</a>
                ` 
            }
        };

        const appRoot = document.getElementById('app-root');
        let isInitialLoad = true; // 초기 로드 여부를 추적하는 플래그 추가
        
        // 2. 콘텐츠 렌더링 함수
        const renderContent = (pathname) => {
            // 경로에서 쿼리스트링이나 해시(#) 제거
            let cleanPath = pathname.split('?')[0].split('#')[0];
            
            // Live Server 문제 우회: cleanPath가 빈 문자열이거나 '/index.html'이면 루트 경로 '/'로 재설정
            if (cleanPath === '' || cleanPath === '/index.html') {
                cleanPath = '/';
            }

            const currentRoute = routes[cleanPath] || routes['404'];
            
            // 애니메이션을 적용할 요소(이전 페이지)를 정확히 선택
            const existingContent = appRoot.querySelector('.page-content');
            
            if (existingContent && !isInitialLoad) {
                // 첫 로드가 아닐 때만 fade-out 애니메이션 적용
                existingContent.classList.add('fade-out');
            }

            // 첫 로드 시 애니메이션을 건너뛰거나, fade-out 후 새 콘텐츠 로드
            const delay = (existingContent && !isInitialLoad) ? 100 : 0;

            setTimeout(() => {
                appRoot.innerHTML = `
                    <div class="page-content">
                        ${currentRoute.content}
                    </div>
                `;
                document.title = currentRoute.title;
                
                // 새로운 콘텐츠가 렌더링된 후 링크 리스너 부착
                attachLinkListeners(); 
                
                isInitialLoad = false; // 첫 로드가 완료되었음을 표시
            }, delay); 
        };

        // 3. 네비게이션 처리 함수 (History API의 핵심)
        const navigate = (pathname) => {
            window.history.pushState(null, '', pathname);
            renderContent(pathname);
        };

        // 4. 네비게이션 링크에 이벤트 리스너를 부착하는 함수
        const attachLinkListeners = () => {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.removeEventListener('click', handleLinkClick);
                link.addEventListener('click', handleLinkClick);
            });
        };
        
        // 링크 클릭 핸들러
        const handleLinkClick = (event) => {
            event.preventDefault(); 
            
            const path = event.currentTarget.getAttribute('data-path');
            if (path) {
                navigate(path);
            }
        };

        // 5. 초기화 및 이벤트 리스너 설정
        window.addEventListener('load', () => {
            // 초기 로드 시 현재 URL 경로에 맞는 콘텐츠 렌더링
            renderContent(window.location.pathname);
            
            // 네비게이션 링크 리스너 부착
            attachLinkListeners();
        });

        // 6. popstate 이벤트 리스너 (뒤로가기/앞으로가기 처리)
        window.addEventListener('popstate', () => {
            // popstate 이벤트는 초기 로드 상태를 변경하지 않으므로 isInitialLoad를 수정하지 않음
            renderContent(window.location.pathname);
        });
    </script>
</body>
</html>
